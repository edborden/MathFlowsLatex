machine:
  services:
    - docker
  pre:
    - sudo curl -sSL https://get.docker.com/ | sh
  environment:
    SHORT_SHA: $(echo $CIRCLE_SHA1 | cut -b1-7)
    TAG_NAME: "br-$CIRCLE_BRANCH-$SHORT_SHA"
    IMAGE_PATH: "edward/mathflowslatex"
dependencies:
  pre:
    - sudo pip install docker-compose==1.3.3
deployment:
  production:
    branch: production
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - heroku plugins:install heroku-docker
      - cd $CIRCLE_PROJECT_REPONAME
      - heroku docker:release --app mathflows-svg
